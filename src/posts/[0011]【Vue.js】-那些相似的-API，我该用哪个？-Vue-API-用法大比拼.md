

## å‰è¨€
Vue.js çš„ API æ¯” React ç¨å¤šï¼ŒæŸäº› API çš„åŠŸèƒ½æœ‰é‡å çš„éƒ¨åˆ†ï¼Œåœ¨å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œå¤šå°‘ä¼šä»¤äººé€ æˆå›°æƒ‘ã€‚é—æ†¾çš„æ˜¯ï¼Œå„ç§æ–‡ç« ã€åšå®¢ç†å¯¹è¿™äº› API çš„ä»‹ç»ï¼Œéƒ½æ˜¯å•ç‹¬æŒ‘å‡ºæˆ–è€…æ³›æ³›è€Œè°ˆï¼ˆç‚¹ååæ§½ä»€ä¹ˆ Vue ä¼ å‚çš„ X ç§æ–¹å¼ï¼‰ã€‚æœ¬æ–‡å°†ä»å¯¹æ¯”çš„è§’åº¦å‡ºå‘ï¼Œåˆ†æè¿™äº›åŠŸèƒ½ç›¸ä¼¼çš„ API å„è‡ªé€‚åˆé‚£äº›ç‰¹å®šåœºæ™¯ã€‚  
å¦‚æœè§‰å¾—æ–‡ç« å¤ªé•¿ï¼Œå¯ä»¥ç›´æ¥è·³åˆ°ã€å°ç»“ã€‘éƒ¨åˆ†ã€‚

## props vs $attrs

åŒæ ·æ˜¯çˆ¶ç»„ä»¶ä¼ å…¥çš„å±æ€§ï¼ŒåŒºåˆ«åœ¨äºï¼š props ä¸­å£°æ˜çš„å±æ€§ä¼šè¢«å­ç»„ä»¶æ•è·ï¼Œå¹¶ä»£ç†åˆ°ç»„ä»¶å®ä¾‹ä¸Šï¼Œæœªè¢«æ•è·çš„å±æ€§ä¼šè¢«æ”¾å…¥ $attrs ä¸­

```javascript
export default {
	props: {
		uidï¼š Number,
		name: {
			type: String,
			default: 'Zhangsan'	
		},
	}
}
```

```javascript
<personal-info :uid="1" name="Xiaoming" mobile="123456789" />
```

props æ•è·äº† `uid` `name` ï¼Œæ‰€ä»¥ç»„ä»¶å†…å¯ä»¥é€šè¿‡ `this.uid` `this.name` è®¿é—®ã€‚è€Œ `mobile` æ²¡æœ‰è¢«ç¿»ç‰Œï¼Œåªå¥½ä¹–ä¹–åœ°æ’è¿› `this.$attrs` é‡Œäº†ã€‚

åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œéœ€è¦å£°æ˜ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ `v-bind="$attrs"` å°†å½“å‰ç»„ä»¶æœªæ•è·çš„å±æ€§é€ä¼ ï¼Œæ¯”å¦‚å®šä¹‰ä¸€ä¸ª button ç»„ä»¶ï¼š
```javascript
<template>
	<button v-bind="$attrs" :disabled="loading">
		<slot><slot>
	</button>
</template>
<script type="text/javascript">
	export default {
		props: {
			loading: Boolean // é™¤äº† loading å…¶ä½™çš„å±æ€§éƒ½è¢«æ‰“å…¥ $attrs ä¸­äº†
		}
	}
</script>
```
è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ä¸€ä¸ªé™¤äº† `loading` ä»¥å¤–å…¶ä»–å±æ€§å’ŒåŸç”Ÿ button ä¸€æ ·çš„ç»„ä»¶ï¼š
```javascript
<my-button 
	id="foo" 
    class="btn normal" 
    :style="buttonStyle"
    :loading="loading"
    @click="$alert('ä½ åœ¨æƒ³ğŸ‘')">ç‚¹å‡»è·å¾— 100 å—</my-button>
```

## data vs computed

`data` ç›´æ¥æ„æ€æ˜¯æ•°æ®ï¼Œç¡®åˆ‡åœ°è¯´æ˜¯ç»„ä»¶è‡ªèº«çš„**çŠ¶æ€**ï¼Œå¯ä»¥åœ¨ç»„ä»¶å†…è¿›è¡Œä¿®æ”¹ã€‚è€Œ `computed` èµ·åˆ°ä¸€ä¸ª**â€œå½’çº³â€** çš„ä½œç”¨ï¼Œç”¨æ¥åˆå¹¶å¤šä¸ªå“åº”å¼æ•°æ®ï¼Œæˆ–è€…å¯¹å“åº”å¼æ•°æ®åšä¸€äº›é€»è¾‘è®¡ç®—ï¼Œå‡å°‘æ¨¡æ¿è¡¨è¾¾å¼çš„é•¿åº¦ã€‚
```javascript
{
	props: {
		gradeAverage: Number, // å¹´çº§å¹³å‡æˆç»©
	},
	data () {
		return {
			students: [
				{ name: 'xiaoming', score: 93 },
				{ name: 'xiaohong', score: 96 },
				{ name: 'zhang3', score: 77 },
				{ name: 'li4', score: 89 },
				{ name: 'wang5', score: 91 }
			]
		}
	},
	computed: {
		// è®¡ç®—å¹³å‡åˆ†
		average() {
			const headCount = this.students.length;
			if (!headCount) {
				return 0;
			}
			const total = this.students.reduce((acc, student) => acc.score + student.score, 0);
			return (total / headCount).toFixed(4)
		},
		// è®¡ç®—ä¸å¹´çº§å¹³å‡åˆ†å·®å€¼
		compareToGrade() {
			const delta = this.average - this.gradeAverage;
			const result = delta > 0 ? 'é«˜äº' : 'ä½äº'
			return `${result} å¹´çº§å¹³å‡ ${Math.abs(delta) åˆ†}`
		}
	}
}
```

å¦‚æœ `computed` å±æ€§åŒæ—¶æä¾› `get / set` æ–¹æ³•ï¼Œè¿™ä¸ªå±æ€§ä¹Ÿèƒ½è¢«èµ‹å€¼:
```javascript
{
	data () {
		return {
			cash: 50
		}	
	},
	computed: {
		yuan: {
			get() {
				return `${this.cash} å…ƒ`
			},
			// v å‚æ•°å°±æ˜¯ç­‰å·å³è¾¹çš„å€¼
			set(v) {
				this.cash = v
			}
		}
	}
}
```
æœ‰äº† `set` æ–¹æ³•ï¼Œæˆ‘ä»¬ç›´æ¥å¯¹ `yuan` è¿›è¡Œèµ‹å€¼æ“ä½œï¼Œå¦‚ `yuan = 168` ï¼Œå°±èƒ½è§¦å‘ `yuan` çš„ `set` æ–¹æ³•ï¼Œ`168` ä¼šä½œä¸ºå‚æ•°ä¼ å…¥ã€‚

## watch ä¸ computed

å‘Šè¯‰ä½ ä»¬ä¸€ä¸ªç§˜å¯†ï¼šä¹‹æ‰€ä»¥æ”¾åœ¨ä¸€èµ·è¯´ï¼Œæ˜¯å› ä¸ºè¿™ä¸¤ä¸ª API æ˜¯å…„å¼Ÿå…³ç³»ï¼Œå®ƒä»¬åœ¨æºç ä¸­æœ‰ç›¸åŒçš„è€çˆ¹ â€”â€” `Watcher`ï¼Œä¸”çœ‹ï¼š
```javascript
export default {
	data() {
		return {
			params: {
				name: ''
			}
		}
	},
	watch: {
		'params.name' (newVal) {
			if (newVal.length > 20) {
				alert('åç§°ä¸å¾—è¶…è¿‡ 20 ä¸ªå­—');
				this.params.name = newVal.slice(20);
			}
		}
	},
	computed: {
		inputName: {
			get() {
				return this.params.name;
			},
			set(newVal) {
				if (newVal.length > 20) {
					alert('åç§°ä¸å¾—è¶…è¿‡ 20 ä¸ªå­—');
				}
				this.params.name = newVal.slice(0, 20);
			}
		}
	}
}
```
å½“ vue å®ä¾‹ä¸­çš„ `params.name` æ”¹å˜ï¼Œå°±ä¼šè§¦å‘è¿™ä¸ª watch å‡½æ•°æ‰§è¡Œï¼Œå½“å¯¹inputName è¿›è¡Œèµ‹å€¼æ“ä½œï¼Œå¦‚ `this.inputName = 'xxx'`ï¼Œå°±ä¼šè§¦å‘ set å‡½æ•°æ‰§è¡Œã€‚
ä»è¯­ä¹‰ä¸Šæ¥è¯´ï¼š watch å¼ºè°ƒè¿‡ç¨‹ï¼Œå½“ä½ çš„æ•°æ®å˜æ›´æ—¶å¯ä»¥ç”¨ watcher å¤„ç†çš„å‰¯ä½œç”¨ã€‚computed å¼ºè°ƒçš„æ˜¯ç»“æœï¼Œä¸ç®¡ä½ ç”¨ä»€ä¹ˆæ–¹æ³•ï¼Œåªè¦è¿”å›å€¼ç¬¦åˆä½ çš„é¢„æœŸå³å¯ã€‚

## methods vs computed
(ä¸‰è‹±æˆ˜ computed)  

computed ä¸ method ä¸åŒçš„æ˜¯ï¼Œcomputed ä¼šæŠŠè®¡ç®—ç»“æœç¼“å­˜èµ·æ¥ï¼Œå½“å†…éƒ¨ä¾èµ–æ”¹å˜å¹¶ä¸”**ç›´åˆ°ä¸‹ä¸€æ¬¡è®¿é—®**æ—¶ï¼Œæ‰ä¼šé‡æ–°æ‰§è¡Œ get å‡½æ•°ã€‚
æ¥çœ‹ä¾‹å­ï¼šä¸€ä¸ªä¸ªäººä¿¡æ¯è¡¨å•ç»„ä»¶ï¼Œåˆå§‹åŒ–æ—¶ä»æœåŠ¡ç«¯è·å–æ•°æ®ï¼Œç°åœ¨éœ€è¦åˆ¤æ–­ params çš„å†…å®¹æ¯”è¾ƒåˆå§‹æ•°æ®æ˜¯å¦æ”¹è¿‡ï¼Œä½¿ç”¨ `method` å’Œ `computed` ä¸¤ç§æ–¹æ³•å®ç°ï¼š
```javascript
{
	data() {
		return {
			oldParams: null,
			params: {
				name: '',
				age: '',
			}
		}
	},
	async created () {
		const info = await fetch('/user/info');
		Object.assign(this.params, info);
		// åŸç‰ˆæ•°æ®å› ä¸ºä¸éœ€è¦å“åº”å¼ï¼Œæ‰€ä»¥å°†å®ƒå†»ç»“èµ·æ¥
		oldParams = Object.freeze(info);
	},
	methods: {
		hasChanged() {
			if (!this.oldParams) {
				return false;
			}
			return (
				oldParams.name === params.name 
				&& oldParams.age === params.age
			)
		},
	},
	computed: {
		computeChanged () {
			if (!this.oldParams) {
				return false;
			}
			return (
				oldParams.name === params.name 
				&& oldParams.age === params.age
			)
		}
	}
}
```

ä¸¤ç§æ–¹å¼çš„ä»£ç ä¸€æ¨¡ä¸€æ ·ï¼ŒåŒºåˆ«åœ¨äºæ‰§è¡Œæ—¶æœºï¼š æ¯æ¬¡è¿›è¡Œ `hasChanged()` è°ƒç”¨æ—¶ method æ–¹æ³•éƒ½ä¼šæ‰§è¡Œï¼Œè¿™ç‚¹æ²¡æœ‰ç–‘é—®ã€‚è€Œå¯¹äº `computeChanged`ï¼šå½“ `oldParams` ã€ `oldParams.name` ã€`oldParams.age` ã€`oldParams` ã€`oldParams` å…¶ä¸­ä»»ä½•ä¸€é¡¹æ”¹å˜ï¼Œ`computeChanged` ä¼šè¢«æ ‡è®°ä¸º `dirty` ï¼Œå†æ¬¡è®¿é—® `computeChanged`ï¼Œæ‰ä¼šé‡æ–°è°ƒç”¨è¿™ä¸ªæ±‚å€¼å‡½æ•°ï¼Œå†™æ®µä»£ç ï¼š
```
export default {
	created() {
		this.computeChanged // computed ç¬¬ä¸€æ¬¡è°ƒç”¨
		for (let i = 0; i < 100; i++) {
			this.computedChanged // ä¾èµ–é¡¹æ²¡æœ‰æ”¹å˜ï¼Œcomputed ä¸ä¼šå†æ¬¡è°ƒç”¨
		}

		this.params.name = 'xxxx' // ä¾èµ–é¡¹æ”¹å˜ï¼Œ computed æ ‡è®°ä¸º dirty

		this.computedChanged // ä¾èµ–é¡¹æ”¹å˜ä»¥åçš„æ±‚å€¼ï¼Œ computed æ›´æ–°è°ƒç”¨
	}
}
```

ä¸å¾—ä¸è¯´ computed å®ä¹ƒå“åº”å¼ API çš„ç²¾é«“ï¼Œå¦‚æœå¸Œæœ›ä½ çš„ template ä»£ç å˜è–„ï¼Œè¯·åŠ¡å¿…åˆ©ç”¨å¥½ computed ã€‚

## methods vs filters

ç›¸å¯¹äº methodsï¼Œ filter æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š
- filters åªèƒ½åœ¨ template ä¸­ä½¿ç”¨
- filters ç›¸å½“äºç®¡é“æ“ä½œç¬¦ï¼ˆç†Ÿæ‚‰ shell çš„ç¨‹åºå‘˜éå¸¸å®¹æ˜“ç†è§£ï¼‰ï¼Œå¯ä»¥å°†è¾“å…¥æ•°æ®ä»å·¦å¾€å³ä¼ é€’
- filters æ˜¯ä¸Šä¸‹æ–‡æ— å…³çš„ï¼Œæ— æ³•åœ¨å†…éƒ¨è®¿é—® this
- filters æ”¯æŒå…¨å±€æ³¨å…¥ï¼Œæ³¨å…¥ä»¥åæ— éœ€ import ä»£ç å°±èƒ½åœ¨æ¯ä¸ªå®ä¾‹å¼•ç”¨

å½“ä½ çš„ value éœ€è¦å¤šä¸ªå‡½æ•°è½¬æ¢æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°åµŒå¥—ç°è±¡ï¼š
```javascript
<span>ä»·æ ¼ {{ method1(method2(value || 0)) }}</span>
```

filters å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ï¼š
```javascript
<span>å¹´é¾„ï¼š {{ value | filter1 | filter2 }}</span>
```

## watch ä¸ $watch

ä¸Šæ–‡ä¸­çš„ `watch` ç›‘å¬æ˜¯å£°æ˜å¼çš„é€‰é¡¹ï¼Œè·Ÿéšç»„ä»¶åˆ›å»ºå’Œé”€æ¯ã€‚å¦‚æœä½ éœ€è¦éšæ—¶æ’¤é”€ç›‘å¬æ“ä½œï¼Œå¯ä»¥è°ƒç”¨ç»„ä»¶å®ä¾‹ä¸Šçš„ `$watch` ï¼Œå®ƒçš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæ’¤é”€å‡½æ•°ï¼Œè°ƒç”¨å³æ’¤é”€ï¼š

```javascript
export default {
	data() {
		return: {
			params: {
				name: '',
			},
			cancel: null
		}
	},
	methods: {
		startWatching() {
			// å°†å–æ¶ˆå‡½æ•°èµ‹ç»™ data
			this.cancel = this.$watch('params.name', ()=>{
				// do sth
			})
		},
		stopWatching() {
			if (!this.cancel) {
				return;
			}
			this.cancel();
		}
	}
}
```

å¦å¤–ï¼Œ`$watch` çš„ç¬¬ä¸€ä¸ªå‚æ•°æ”¯æŒä¼ å…¥å‡½æ•°ï¼Œä»¥ä¾¿å®ç°æ›´å¤æ‚çš„è§¦å‘æ¡ä»¶ï¼Œæ¯”å¦‚ï¼š
```javascript
this.$watch(
	// è§¦å‘æ¡ä»¶
	()=> {
    	const { name } = this.params;
        if (!name) {
        	return 'åç§°ä¸èƒ½ä¸ºç©º'
        }
        if (name.length > 20) {
        	return 'åç§°ä¸èƒ½è¶…è¿‡ 20 ä¸ªå­—'
        }
    },
    // è§¦å‘å›è°ƒ
    (message) => {
    	if (message) {
        	alert(message)
        }
    },
    // å»¶è¿Ÿæ‰§è¡Œ
    {
    	immediate: false
    }
)
```

## v-model vs .sync

äºŒè€…éƒ½æ˜¯æ¨¡æ¿çš„è¯­æ³•ç³–ï¼Œå…¶ä¸­ v-model å°±æ˜¯å„è·¯æ–‡ç« é¼“å¹çš„â€œåŒå‘ç»‘å®šâ€ï¼Œå…¶å®æ²¡é‚£ä¹ˆç„ä¹ï¼Œvue åœ¨æ¨¡æ¿ç¼–è¯‘æœŸä¼šæŠŠè¿™ä¸ªæŒ‡ä»¤æ‹†æˆ value å’Œ changeï¼ˆæˆ–è€… inputï¼‰ äº‹ä»¶ç½¢äº†ã€‚ç”±äºå•å‘æ•°æ®æµçš„å…³ç³»ï¼Œå­ç»„ä»¶ä¸èƒ½ç›´æ¥ä¿®æ”¹ props ï¼Œéœ€è¦é€šè¿‡å‘é€äº‹ä»¶å®ç°ï¼Œè€Œ v-model / .sync åœ¨æ¨¡æ¿å±‚é¢å¸®ä½ åšäº†è¿™å±‚å°è£…ï¼š

### v-model

v-model ä¸€èˆ¬ç”¨äºåŸç”Ÿçš„ input ã€ checkbox ã€ select è¡¨å•ä½œä¸ºâ€œåŒå‘ç»‘å®šâ€æŒ‡ä»¤ï¼Œå½“æ™®é€šç»„ä»¶å¼•ç”¨ä¸­å‡ºç° v-model æŒ‡ä»¤ï¼Œä¼šè‡ªåŠ¨æ¨å¯¼ä¸º `:value` å’Œ `@change`ã€‚åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå¦‚æœåœ¨ç»„ä»¶å†…éƒ¨æ‹¼å‡‘å‡º `value` å±æ€§å’Œ `change` äº‹ä»¶ï¼Œä¹Ÿå¯ä»¥å®Œæˆâ€œåŒå‘ç»‘å®šâ€æ•ˆæœï¼š

```javascript
<template>
	<div>
		<!-- æ‹¼å‡‘ value -->
		<span>{{value}}</span>
		<!-- æ‹¼å‡‘ @change -->
		<button @click="$emit('change', value + 1)">+</button>
		<button @click="$emit('change', value - 1)">-</button>
	</div>
</template>

<script type="text/javascript">
export default {
	props: {
		value: Number
	}
}
</script>
```

å¤–å±‚å¼•ç”¨ç»„ä»¶æ—¶ï¼Œä¼ å…¥ v-model ï¼Œå°±å¯ä»¥åƒæ™®é€šè¾“å…¥æ¡†ä¸€æ ·ä½¿ç”¨äº†ï¼
```javascript
<my-counter v-model="myCount" />
```
ç­‰ä»·äºï¼š
```javascript
<my-counter :value="myCount" @change="v => myCount = v" />
```

åœ¨ 2.2.0+ ç‰ˆæœ¬ï¼Œvue æ”¯æŒæŒ‡å®š model é€‰é¡¹ï¼Œè‡ªå®šä¹‰å­—æ®µåå’Œ event äº‹ä»¶åï¼š

```javascript
<template>
	<div>
		<!-- è‡ªå®šä¹‰å±æ€§ count -->
		<span>{{count}}</span>
		<!-- è‡ªå®šä¹‰äº‹ä»¶ setCount -->
		<button @click="$emit('setCount', value + 1)">+</button>
		<button @click="$emit('setCount', value - 1)">-</button>
	</div>
</template>
export default {
	model: {
		prop: 'count',
		event: 'setCount'
	},
	props: {
		count: Number
	}
}
```

æ³¨æ„ï¼Œä¸€ä¸ªç»„ä»¶åªèƒ½å®šä¹‰ä¸€ä¸ª modelï¼Œå¦‚æœå¸Œæœ›å®šä¹‰å¤šä¸ªï¼Œè¯·çœ‹ä¸‹æ–‡çš„ `.sync` ä¿®é¥°ç¬¦ï¼š

### .sync
åŒæ­¥å±æ€§å±æ€§ä¿®é¥°ç¬¦ï¼Œé€šè¿‡çº¦å®šçš„äº‹ä»¶æ ¼å¼ï¼Œé€šçŸ¥çˆ¶ç»„ä»¶åŒæ­¥æ›´æ–°ï¼ŒåŸç†è·Ÿ v-model ç›¸ä¼¼ã€‚ä¸åŒçš„æ˜¯ï¼Œäº‹ä»¶åç§°è¦éµå¾ª `update:å±æ€§` æ ¼å¼ï¼š

```javascript
<template>
	<div>
		<span>{{count}}</span>
		<button @click="$emit('update:count', count + 1)">+</button>
		<button @click="$emit('update:count', count - 1)">-</button>
	</div>
</template>

<script type="text/javascript">
export default {
	props: {
		count: Number
	}
}
</script>
```
å¤–å±‚ä½¿ç”¨ï¼š
```javascript
<my-counter :count.sync="myCount" />
```
ç­‰ä»·äºï¼š
```javascript
<my-counter :count="myCount" @update:count="c => myCount = c" />
```
ä¸ v-model ä¸åŒï¼Œ.sync å¯ä»¥ä¿®é¥°å¤šä¸ªå±æ€§

## render vs template

æˆ‘ä»¬å¹³æ—¶ç¼–å†™çš„ template å¹¶ä¸ä¼šé©¬ä¸Šè½¬åŒ–ä¸ºè™šæ‹Ÿ DOM èŠ‚ç‚¹ï¼Œè€Œæ˜¯å…ˆç¼–è¯‘æˆ render å‡½æ•°ã€‚ä¸”çœ‹å®˜æ–¹æ–‡æ¡£ä¸­ `render` å‡½æ•°çš„å¼•å­ï¼š

> Vue æ¨èåœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨æ¨¡æ¿æ¥åˆ›å»ºä½ çš„ HTMLã€‚ç„¶è€Œåœ¨ä¸€äº›åœºæ™¯ä¸­ï¼Œä½ çœŸçš„éœ€è¦ JavaScript çš„å®Œå…¨ç¼–ç¨‹çš„èƒ½åŠ›ã€‚è¿™æ—¶ä½ å¯ä»¥ç”¨æ¸²æŸ“å‡½æ•°ï¼Œå®ƒæ¯”æ¨¡æ¿æ›´æ¥è¿‘ç¼–è¯‘å™¨ã€‚

è¯´å¾—å†ç›´ç™½ä¸€ç‚¹ï¼šrender å‡½æ•°æ˜¯çœŸæ­£åˆ›å»ºè™šæ‹Ÿ DOM çš„å‡½æ•°ï¼š
```javascript
export default {
	render (createElement) {
		const { msg } = this;
		return createElement('h3', { style: { color: '#66ccff' } }, `Hello ${msg}`)
	}
}
```
æœ€ç»ˆç”Ÿæˆï¼š
> ### <font color="">Hello World</font>

ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœæä¾›è¿™ä¹ˆä¸€ä¸ª `template` æ¨¡æ¿ï¼š
```javascript
<div><span>{{ msg }}</span></div>
```
ç»è¿‡ Vue çš„ç¼–è¯‘ï¼Œå®ƒå°†å˜æˆï¼š
```javascript
function () {
	with(this){
		return createElement(
			'div',
			[
				createElement('span', [ createTextVNode( toString(msg) ) ])
			]
		)
	}
}
```
å¦‚æ–‡æ¡£æ‰€è¨€ï¼Œæ¨¡æ¿å¯ä»¥æ›´ç›´è§‚åœ°æ˜ å°„ HTML ï¼Œä½†æŸäº›ç‰¹å®šåœºæ™¯ä¸‹ï¼Œç›´æ¥ä½¿ç”¨ `render` å‡½æ•°ä¼šæ¯”æ¨¡æ¿æ›´çµæ´»ï¼Œå®˜æ–¹æ–‡æ¡£ä¸­ä»‹ç»äº†ä¸€ç§åŠ¨æ€æ ‡é¢˜çš„ç¤ºä¾‹ï¼Œæ ¹æ® `level` å±æ€§å†³å®šæ¸²æŸ“ `h1` ~ `h6` æ ‡ç­¾ï¼Œä½¿ç”¨ `render` å‡½æ•°å¯ä»¥è¿™ä¹ˆå†™ï¼š
```javascript
export default {
	name: 'my-title'
	props: {
		level: {
			type: Number
		},
	},
	render(createElement) {
		// è·å–ä¼ å…¥çš„å±æ€§ã€å’Œæ’æ§½ï¼ˆå­æ¨¡æ¿ï¼‰
		const { $attrs, level, $slot } = this;
		const children = $slot.default;
		// æ ‡ç­¾åç§° h1 ~ h6
		const tag = `h${level}`; 
		return createElement(tag, $attrs, children)
	}
}
```
ä½¿ç”¨ï¼š 
```javascript
<my-title :level="1" style="color:#333">è¿™æ˜¯ h1</my-title>
<my-title :level="2" style="color:#666">è¿™æ˜¯ h2</my-title>
<my-title :level="3" style="color:#999">è¿™æ˜¯ h3</my-title>
```

è¯•æƒ³ä¸€ä¸‹ï¼šå¦‚æœæˆ‘ä»¬ä½¿ç”¨ `template` è¯­æ³•æ¥å®ç°çš„è¯å°±è¦å£°æ˜6ä¸ª `v-if` æ¨¡æ¿ï¼Œéå¸¸å•°å—¦ã€‚ä¸è¿‡ render å‡½æ•°ä¹Ÿæ˜¯ä¸€æŠŠåŒåˆƒå‰‘ï¼šä½¿ç”¨ render å‡½æ•°æ— æ³•ä½¿ç”¨ `v-model` è¿™ä¸ªæ¨¡æ¿ä¸“å±çš„è¯­æ³•ç³–ï¼ŒåŒæ—¶ä¹Ÿå¤±å»äº†é™æ€æ¨¡æ¿ä¼˜åŒ–çš„å¯èƒ½æ€§ï¼ˆæœ‰å¾—å¿…æœ‰å¤±ï¼‰ã€‚

ä¹Ÿè®¸ä½ å·²ç»å‘ç°ï¼š `createElement` çš„æ€è·¯ä¸ `React.createElement` ä¸€è„‰ç›¸æ‰¿ã€‚æ—¢ç„¶å¯ä»¥é€šè¿‡ JSX ç¼–å†™ ReactElement ï¼Œèƒ½å¦ä½¿ç”¨ JSX ç¼–å†™ render å‡½æ•°å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼šæ ¹æ®å®˜æ–¹æ–‡æ¡£ä»‹ç»ï¼Œé€šè¿‡è¿™ä¸ª [Babel æ’ä»¶](https://github.com/vuejs/jsx)ï¼Œå°±èƒ½åœ¨ Vue æ–‡ä»¶ä¸­æ„‰å¿«åœ°ä½¿ç”¨JSXäº†ï¼Œè¯¦æƒ…ç§»æ­¥[å®˜æ–¹æ–‡æ¡£](https://cn.vuejs.org/v2/guide/render-function.html#JSX)

## functional vs stateful


å‡å¦‚ä½ çš„ç»„ä»¶æœ¬èº«ä¸éœ€è¦å“åº”å¼æ•°æ®ï¼Œæ‰€æœ‰çš„è¡Œä¸ºéƒ½å—æ§çˆ¶ç»„ä»¶çš„è¾“å…¥ï¼Œä¸å¦¨å¯¹è¿™ä¸ªç»„ä»¶æ·»åŠ  `functional` å±æ€§ï¼š

```javascript
export default {
	// æ ‡è®°ä¸ºå‡½æ•°å¼
	functional: true,
	name: 'my-button',
	props: {
		type: String,
		style: [Object, String]
	},
	render (h, context) {

		console.log(this); // å‡½æ•°å¼ç»„ä»¶æ²¡æœ‰ thisï¼Œä¸º undefined
		// å‡½æ•°å¼ç»„ä»¶çš„ä¸Šä¸‹æ–‡ context
		// æ³¨æ„å› ä¸ºæ²¡æœ‰ this æ‰€ä»¥ä¸Šä¸‹æ–‡å±æ€§å°±ä¸èƒ½å«åšå®ä¾‹å±æ€§äº†ï¼Œåç§°å¼€å¤´ä¸å¸¦ $
		const { props, slot, listeners } = context; 
		const { type = 'info', style } = props;
		// æ ¹æ® type å†³å®šèƒŒæ™¯é¢œè‰²
		const backgroundColor = {
			danger: 'red',
			success: 'green',
			info: 'blue',
			disabled: 'gray'
		}[type];

		return h(
			'button', 
			{
				'class': 'my-btn',
				style: {
					color: 'white',
					outline: 'none',
					backgroundColor,
					...style,
				},
				on: listeners
			},
			slot.default
		)
	}

}
```

ä¸Šé¢çš„ä»£ç æ˜¯ä¸ºäº†å®ç°ä¸€ä¸ªç®€å•çš„æ ·å¼ button ï¼Œ å› ä¸ºæ·»åŠ äº† `functional: true` å±æ€§ï¼Œè¿™ä¸ªç»„ä»¶å°±å˜æˆäº†ä¸€ä¸ª**å‡½æ•°å¼ç»„ä»¶**ï¼Œä¸æ™®é€šçš„ç»„ä»¶ï¼ˆæˆ‘ç§°ä¹‹ä¸º **stateful ç»„ä»¶**ï¼‰ä¸åŒï¼Œå®ƒæ˜¯æ— çŠ¶æ€çš„ï¼Œä¸èƒ½è®¿é—® this ï¼Œéœ€è¦å€ŸåŠ© `context` å¯¹è±¡ï¼ŒåŒæ—¶ `data` ã€ `computed` ã€ `watch` ç­‰å“åº”å¼ API æ— æ³•ä½¿ç”¨ï¼ˆåªèƒ½å“åº”çˆ¶ç»„ä»¶çš„ï¼‰ã€‚ä½†æ˜¯å®ƒæ›´ä¸ºè½»é‡ï¼Œæ¯” stateful ç»„ä»¶åˆ›å»ºå‡å°‘äº†ä¸å¿…è¦çš„å¼€é”€ã€‚

å¦å¤–ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨å‡½æ•°å¼æ¨¡æ¿ï¼Œåœ¨ template æ ‡ç­¾ä¸­æ·»åŠ  `functional` å±æ€§å³å¯ï¼Œè¿™é‡Œåˆå·æ‡’ç›´æ¥ç”¨å®˜æ–¹ç¤ºä¾‹ï¼š
```javascript
<template functional>
	<button class="my-button" v-bind="data.attrs" v-on="listeners">
		<slot></slot>
	</button>
</template>
```
æ­£å¸¸ç»„ä»¶ template è¢«åŒ…è£¹åœ¨ `this` ä¸­ï¼Œè€Œå‡½æ•°å¼ç»„ä»¶å°±è¢«åŒ…è£¹ä¸º `context` ä¸­ï¼Œå¯ä»¥ç›´æ¥å¼•ç”¨ `context` ä¸Šçš„å±æ€§ã€‚

## $set vs assignment èµ‹å€¼
```javascript
export default {
	data () {
		params: {
			name: ''
		}
	},
	methods: {
		setAge (age) {

			if (!age) {
				delete this.params.age;
				return;
			}

			this.params.age = age;
		}
	}
}
```

ç”±äº `Object.defineProperty` çš„å±€é™ï¼Œç›´æ¥å¯¹å¯¹è±¡è¿›è¡Œæ·»åŠ /åˆ é™¤å±æ€§æ“ä½œæ˜¯æ— æ³•è¢«ç›‘å¬çš„ï¼Œéœ€è¦æ¢æˆ `vm.$set` å’Œ `vm.$delete`ï¼š
```javascript
setAge(age) {
	if (!age) {
		this.$delete(this.params, 'age');
		return;
	}
	this.$set(this.params, 'age', age);
}
```

## å°ç»“

- `props` ä¸­å£°æ˜çš„å±æ€§ä¼šè¢«æ•è·å¹¶æŒ‚åœ¨ç»„ä»¶å®ä¾‹ä¸Šï¼Œå¦åˆ™ä¼šæŒ‚è¿› `$attrs` ä¸­
- ä½¿ç”¨ `v-bind="$attrs"` å¯ä»¥å®ç°å±æ€§é€ä¼ 
- `data` å¯ä»¥ç†è§£ä¸ºç»„ä»¶ä¸­çš„å“åº”å¼çŠ¶æ€
- `watch` ä¸ `computed` éƒ½æ˜¯ `Watcher` çš„å®ä¾‹ã€‚ `watch` æ³¨é‡è¿‡ç¨‹å’Œå‰¯ä½œç”¨ï¼Œ`computed` æ³¨é‡ç»“æœ
- `computed` å…·æœ‰ç¼“å­˜å“åº”å¼ä¾èµ–çš„æ•ˆæœ
- `filters` å¯ä»¥ç†è§£ä¸ºæ¨¡æ¿çš„ç®¡é“æ“ä½œç¬¦ï¼Œä¸ä¸Šä¸‹æ–‡ï¼ˆç»„ä»¶å®ä¾‹ï¼‰æ— å…³
- `$watch` æ˜¯æŒ‚åœ¨ç»„ä»¶å®ä¾‹ä¸Šçš„æ–¹æ³•ï¼Œå¯ä»¥éšæ—¶è°ƒç”¨å’Œæ’¤é”€ï¼Œæ”¯æŒå¤æ‚çš„è§¦å‘æ¡ä»¶
- `v-model` æ˜¯ `value` ä¸` @change` çš„åˆä½“ï¼Œç»„ä»¶ä¸­å”¯ä¸€
- `.sync` æ˜¯çº¦å®šåŒ–çš„çˆ¶å­ç»„ä»¶é€šä¿¡ï¼Œç»„ä»¶ä¸­å¯ä»¥å®šä¹‰å¤šä¸ª
- `render` æ˜¯çœŸæ­£ç”Ÿæˆè™šæ‹Ÿ DOM çš„æ–¹æ³•ï¼Œ`template` æœ€ç»ˆä¼šè¢«ç¼–è¯‘æˆ `render` å‡½æ•°ã€‚ç›´æ¥ä½¿ç”¨ `render` å‡½æ•°å¯ä»¥æ›´çµæ´»åœ°å¤„ç†ç»„ä»¶è¡¨ç°é€»è¾‘ã€‚
- `functional` æ˜¯æ— çŠ¶æ€çš„ç»„ä»¶
- å¦‚æœéœ€è¦å¯¹å“åº”å¼æ•°æ®æ·»åŠ /åˆ é™¤å±æ€§ï¼Œéœ€è¦å€ŸåŠ© `$set/$delete` æ–¹æ³•ã€‚
